- name: Patch buildozer.spec (app basic)
        run: |
          python - <<'PY'
          import re, pathlib

          p = pathlib.Path("buildozer.spec")
          s = p.read_text(encoding="utf-8")

          def set_kv(text, key, value):
            pat = rf"^{re.escape(key)}\s*=.*$"
            if re.search(pat, text, flags=re.M):
              return re.sub(pat, f"{key} = {value}", text, flags=re.M)
            else:
              return text + f"\n{key} = {value}\n"

          s = set_kv(s, "title", "Snake Game")
          s = set_kv(s, "package.name", "snakegame")
          s = set_kv(s, "package.domain", "org.example")
          s = set_kv(s, "source.include_exts", "py,png,jpg,kv,atlas")
          s = set_kv(s, "requirements", "python3,kivy")
          s = set_kv(s, "android.api", "33")
          s = set_kv(s, "android.minapi", "21")
          s = set_kv(s, "android.ndk", "25b")

          p.write_text(s, encoding="utf-8")
          print("buildozer.spec patched")
          PY
